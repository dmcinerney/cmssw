from CondCore.DBCommon.CondDBSetup_cfi import *

# loading magnetic field and geometry
#process.load('Configuration.StandardSequences.GeometryExtended_cff')
process.load("Configuration.StandardSequences.GeometryIdeal_cff")

from Geometry.CommonDetUnit.globalTrackingGeometry_cfi import *


#Tracker
from RecoTracker.GeometryESProducer.TrackerRecoGeometryESProducer_cfi import *

#Muon
from Geometry.MuonNumbering.muonNumberingInitialization_cfi import *
from RecoMuon.DetLayers.muonDetLayerGeometry_cfi import *

#  Alignment
from Geometry.TrackerGeometryBuilder.idealForDigiTrackerGeometry_cff import *
from Geometry.CSCGeometryBuilder.idealForDigiCscGeometry_cff import *
from Geometry.DTGeometryBuilder.idealForDigiDtGeometry_cff import *
process.load("Configuration.StandardSequences.MagneticField_cff")
#process.load("Configuration.Geometry.GeometryRecoDB_cff")

# loading the alignment producer
process.load("Alignment.CommonAlignmentProducer.AlignmentProducer_cff")

# loading DB constants 
# *WARNING* - the standard file doesn't work (gives too many "SiStripPedestalsFakeSource" rcds) 
# comment out that line in standard file ... an example is given in release of HIPAlignmentAlgorithm ("FrontierConditions_GlobalTag_cff.py")
process.load("Configuration.StandardSequences.FrontierConditions_GlobalTag_cff")

#if 'COSMICS'=='<FLAG>':
#   process.GlobalTag.globaltag='MCRUN2_71_V0::All'
#else :
#   process.GlobalTag.globaltag='MCRUN2_71_V0::All'
 
process.load("FWCore.MessageService.MessageLogger_cfi")
process.MessageLogger.cerr.FwkReport.reportEvery = 10000

# configure magnetic field
# process.load("Configuration.StandardSequences.MagneticField_38T_cff")

# configure the database file - use survey one for default
from CondCore.DBCommon.CondDBSetup_cfi import *

# ########## Ideal Alignment 
# process.trackerAlignment = cms.ESSource("PoolDBESSource",
#                                         CondDBSetup,	
#                                         timetype = cms.string('runnumber'),
#                                         toGet = cms.VPSet(cms.PSet(record = cms.string('TrackerAlignmentRcd'),
#                                                                    tag = cms.string('TrackerIdealGeometry210_mc')
#                                                                    )
#                                                           ),
#                                         connect = cms.string('frontier://FrontierProd/CMS_COND_31X_FROM21X')
#                                         )

# process.es_prefer_trackerAlignment = cms.ESPrefer("PoolDBESSource", "trackerAlignment")

# ########## Zero APE
# from CondCore.DBCommon.CondDBSetup_cfi import *
# process.ZeroAPE = cms.ESSource("PoolDBESSource",CondDBSetup,
#                                connect = cms.string('frontier://FrontierProd/CMS_COND_31X_FROM21X'),
#                                timetype = cms.string("runnumber"),
#                                toGet = cms.VPSet(cms.PSet(record = cms.string('TrackerAlignmentErrorExtendedRcd'),
#                                                           tag = cms.string('TrackerIdealGeometryErrors210_mc')
#                                                           )
#                                                  )
#                                )

# process.es_prefer_ZeroAPE = cms.ESPrefer("PoolDBESSource", "ZeroAPE")

# For global tag geometry 
# !!!! Pass only  "unlimited Interval Of Validity (IOV)" DB objects for
# conditions as described in https://twiki.cern.ch/twiki/bin/view/CMSPublic/SWGuideHIPAlgorithm#Run_HIP

process.GlobalTag.toGet = cms.VPSet(
   cms.PSet(record = cms.string('TrackerAlignmentRcd'),
            tag = cms.string('Alignments'),
            connect = cms.untracked.string('sqlite_file:/afs/cern.ch/cms/CAF/CMSALCA/ALCA_TRACKERALIGN2/HIP/xiaomeng/Inflate/CMSSW_7_4_0_pre6/src/Alignment/HIPAlignmentAlgorithm/craftLAPE_module_gt_LA_template/alignments_iter50.db'),
#            tag = cms.string('TrackerAlignment_2015StartupPessimisticScenario_mc'),
#            connect = cms.untracked.string('frontier://FrontierProd/CMS_COND_31X_ALIGNMENT')
            ),
   cms.PSet(record = cms.string('GlobalPositionRcd'),
            tag = cms.string('GlobalAlignment'),
            connect = cms.untracked.string('sqlite_file:/afs/cern.ch/cms/CAF/CMSALCA/ALCA_TRACKERALIGN2/HIP/xiaomeng/CMSSW_7_4_0_pre6/src/Alignment/HIPAlignmentAlgorithm/GR_P_V49_GP.db'),
            ),
   cms.PSet(record = cms.string('TrackerSurfaceDeformationRcd'),
            tag = cms.string('SurfaceDeformations'),
            connect = cms.untracked.string('sqlite_file:/afs/cern.ch/cms/CAF/CMSALCA/ALCA_TRACKERALIGN2/HIP/xiaomeng/CMSSW_7_4_0_pre6/src/Alignment/HIPAlignmentAlgorithm/GR_P_V49_SD.db')
            ),
#   cms.PSet(record = cms.string('TrackerAlignmentErrorExtendedRcd'),
#            tag = cms.string('TrackerAlignmentErrors_2015StartupPessimisticScenario_mc'),
#            connect = cms.untracked.string('frontier://FrontierProd/CMS_COND_31X_ALIGNMENT')
#            ),
   )


############ Load APE separately

######## Zero APE
from CondCore.DBCommon.CondDBSetup_cfi import *
process.ZeroAPE = cms.ESSource("PoolDBESSource",CondDBSetup,
                                        connect = cms.string('sqlite_file:/afs/cern.ch/cms/CAF/CMSALCA/ALCA_TRACKERALIGN2/HIP/xiaomeng/CMSSW_7_4_0_pre6/src/Alignment/HIPAlignmentAlgorithm/GR_P_V49_APE.db'),
                                        timetype = cms.string("runnumber"),
                                        toGet = cms.VPSet(
                                                          cms.PSet(record = cms.string('TrackerAlignmentErrorRcd'),
                                                                   tag = cms.string('AlignmentErr')
                                                                   ))
                                        )
process.es_prefer_ZeroAPE = cms.ESPrefer("PoolDBESSource", "ZeroAPE")


####### CRAFT10 APE
# process.trackerAPE = cms.ESSource("PoolDBESSource",CondDBSetup,
#                                connect = cms.string('sqlite_file:/afs/cern.ch/cms/CAF/CMSALCA/ALCA_TRACKERALIGN/PayLoads/CRAFT09/TrackerAlignmentErr_2009_v2_prompt/131425-infty/TrackerAlignmentErr_2009_v2_prompt.db'),
#
#                                   timetype = cms.string("runnumber"),
#                                   toGet = cms.VPSet(
#                                         cms.PSet(record = cms.string('TrackerAlignmentErrorRcd'),
#                                                  tag = cms.string('AlignmentErrors')
#                                                 ))
#                                         )
# process.es_prefer_TrackerAPE = cms.ESPrefer("PoolDBESSource", "trackerAPE")


process.AlignmentProducer.applyDbAlignment = True


### Set parameters to align (all modules in this example)

process.AlignmentProducer.ParameterBuilder.Selector = cms.PSet(
                                                    alignParams = cms.vstring(
                                                        'TrackerTPBModule,111111',
                                                        'TrackerTPEModule,111111',
                                                        'TrackerTIBModuleUnit,101111',
                                                        'TrackerTOBModuleUnit,101111',
                                                        'TrackerTIDModuleUnit,111111',
                                                        'TrackerTECModuleUnit,111111',
#                                                                           'TrackerTPBLadder,111111',
#                                                                           'TrackerTPEBlade,111111',
#                                                                           'TrackerTIBString,101111',
#                                                                           'TrackerTOBRod,101111',
#                                                                           'TrackerTIDRing,111111',
#                                                                           'TrackerTECRing,111111'
#                                                                 'PixelHalfBarrelDets,111111',
#                                                                 'PXECDets,111111',
#                                                                 'TrackerTIBModuleUnit,101001',
#                                                                 'TrackerTOBModuleUnit,101001',
#                                                                 'TrackerTIDModuleUnit,101001',
#                                                                 'TrackerTECModuleUnit,101001',
                                                                 ),
)

